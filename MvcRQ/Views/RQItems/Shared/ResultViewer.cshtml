<script type="text/javascript">
    $(document).ready(function () {
        //var d = document.location.href;
        //if (d.indexOf("?") != -1) {
        //    alert(d.substring(0, d.indexOf("?")));
        //    d = d.substring(0, d.indexOf("?"))
        //}
        //var c = d + "?verb=rqListHTML";
        var c = cleanUrl() + "?verb=rqListHTML";
        
        $.ajax({
            url: c,
            type: "GET",
            data: null,
            dataType: "html",
            success: function (data) {
                renderHtmlList(data);
            },
            error: function (xhr) {
                alert(xhr.responseText);
            }
        });
    });

    function renderHtmlList(data) {
        $("#htmlList").html(data);
    }

    function renderXmlList(data, domElementID) {
        var xml = window.ActiveXObject ? data.xml : (new XMLSerializer().serializeToString(data));
        //$("#" + domElementID).transform({ xmlstr: xml, xsl: document.location.href.substring(0, document.location.href.indexOf("RQItems")) + "xslt/ViewTransforms/RQI2SingleItemView.xslt" });
        $("#" + domElementID).transform({ xmlstr: xml, xsl: cleanUrl().substring(0, cleanUrl().indexOf("RQItems")) + "xslt/ViewTransforms/RQI2SingleItemView.xslt" });
    }

    function renderFieldContent(data, domElementID) {
        var xml = window.ActiveXObject ? data.xml : (new XMLSerializer().serializeToString(data));
        //$("#" + domElementID).transform({ xmlstr: xml, xsl: document.location.href.substring(0, document.location.href.indexOf("RQItems")) + "xslt/ViewTransforms/RQItemFields.xslt" });
        $("#" + domElementID).transform({ xmlstr: xml, xsl: cleanUrl().substring(0, cleanUrl().indexOf("RQItems")) + "xslt/ViewTransforms/RQItemFields.xslt" });
    }

    function getRQItem(docno, newDomElementID, oldDomElementID) {
        if ($("#" + newDomElementID).is(":empty")) {
            $("#" + newDomElementID).html("<div id='loading'><img src='/images/ajax-loader.gif' alt='Please Wait' /></div>");
            $.ajax({
                //url: document.location.href + "/" + docno + "?verb=rqSingleHTML",
                url: cleanUrl() + "/" + docno + "?verb=rqSingleHTML",
                type: "GET",
                data: null,
                dataType: "xml",
                success: function (data) {
                    renderXmlList(data, newDomElementID);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.responseText);
                    $("#" + newDomElementID).html("");
                }     
            });
        }
        $("#" + oldDomElementID).toggle();
        $("#" + newDomElementID).toggle("slow");
    }

    function call(path) {
        //window.location = document.location.href.substring(0, document.location.href.indexOf("RQItems")) + path;
        window.location = cleanUrl().substring(0, cleanUrl().indexOf("RQItems")) + path;
    }

    function callAjax(path, domElementID) {
        $.ajax({
            url: path,
            type: "GET",
            data: null,
            dataType: "xml",
            success: function (data) {
                renderFieldContent(data, domElementID);
            }
        });
    }

    function visibilityToggle(id) {
        $("#" + id).slideToggle("slow");
    }

    function cleanUrl() {
        var d = document.location.href;
        if (d.indexOf("?") != -1) {
            return d.substring(0, d.indexOf("?"))
        }
        else {
            return d;
        }
    }

</script>
<div id="htmlList"></div>